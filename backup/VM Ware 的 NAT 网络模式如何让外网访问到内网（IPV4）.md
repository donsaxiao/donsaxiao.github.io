# **VM Ware 的 NAT 网络模式如何让外网访问到内网（IPV4）**


在 VMware 的 NAT（网络地址转换）模式下，默认情况下虚拟机是被“隐藏”在宿主机（物理机）后面的。这意味着虚拟机可以访问外网，但外网（包括局域网内的其他设备）无法直接访问虚拟机。

为了让外网能够访问到 NAT 模式下的虚拟机，核心思路是**“端口转发”（Port Forwarding）**。你可以把它想象成：在宿主机这个“大门”上开一个特定的“小窗口”，把发往这个窗口的请求，定向传递给身后的虚拟机。

以下是具体的实现步骤和方案：

## 🛠️ **方案一：配置 VMware 端口转发（最常用）**
这是最标准的解决方法。通过配置 VMware 的 NAT 设置，将宿主机的某个端口映射到虚拟机的端口。

**1. 确认虚拟机网络模式**
首先，确保你的虚拟机设置中，“网络适配器”选择的是 NAT 模式。

**2. 获取虚拟机 IP 地址**
启动虚拟机，查看其 IP 地址（例如 192.168.100.104）。
● 注意：建议在虚拟机内部将 IP 设置为静态 IP，或者在 VMware 的 DHCP 范围外分配，防止 IP 变化导致映射失效。

**3. 配置端口转发规则**
这是最关键的一步，不同操作系统下的操作略有不同：
● **Windows 宿主机**：
a. 打开 VMware Workstation，点击菜单栏的   “编辑” > “虚拟网络编辑器”  。
b. 选中 VMnet8 (NAT 模式)，点击右下角的   “NAT 设置”   按钮。
c. 在弹出的窗口中切换到   “端口转发”   选项卡，点击   “添加”  。
d. 填写规则：
■ 主机端口： 宿主机对外开放的端口（例如 8080）。
■ 虚拟机 IP 地址： 刚才查到的虚拟机 IP（例如 192.168.100.104）。
■ 虚拟机端口： 虚拟机内部服务的端口（例如 Web 服务是 80）。
■ 描述： 随便填，方便自己识别（我这里写RayOJ）。

<img width="891" height="780" alt="Image" src="https://github.com/user-attachments/assets/d520c289-2126-4217-9ea8-f4639194b8b4" />

<br><br>

<img width="729" height="756" alt="Image" src="https://github.com/user-attachments/assets/974d4f1d-f9b0-44dd-9124-c75a131ec01f" />

<br><br>

● **macOS 宿主机 (VMware Fusion)**：
macOS 下图形界面配置较麻烦，通常需要手动编辑配置文件 nat.conf。
a. 找到配置文件路径（通常在 /Library/Preferences/VMware Fusion/vmnet8/nat.conf）。
b. 在 [incomingtcp] 区域下添加规则，格式为：宿主机端口 = 虚拟机IP:虚拟机端口。
c. 保存后重启 VMware 网络服务。

## **4. 防火墙放行**
● 宿主机防火墙： 必须允许外部访问你设置的“主机端口”（如 8080）。你需要在 Windows Defender 防火墙或第三方防火墙中添加入站规则。
● 虚拟机防火墙： 确保虚拟机内部的防火墙允许来自宿主机的连接。


## 🌐 **方案二：结合路由器端口映射（实现真正外网访问）**
如果你不仅想让局域网内的同事访问，还想让互联网上的用户访问（例如在家中服务器部署网站），你需要配合路由器设置。

1. 完成上述的 VMware 端口转发（例如：宿主机 8080 -> 虚拟机 80）。
2. 查询宿主机局域网 IP：例如 192.168.100.104。
3. 登录路由器后台：找到   “虚拟服务器”   或   “端口映射”   设置项。
4. 添加规则：
○ 外部端口：80（或者你想用的其他端口，如 8081）。
○ 内部 IP 地址：192.168.100.104（宿主机 IP）。
○ 内部端口：8080（对应 VMware 设置的主机端口）。
5. 访问方式：外网用户通过   “你的公网 IP:外部端口”   即可访问到虚拟机。

## 📊 **三种模式对比总结**
为了让你更直观地理解，我整理了 VMware 三种主要模式在网络访问方面的区别：

<img width="1230" height="414" alt="Image" src="https://github.com/user-attachments/assets/b6909879-ff5e-47f4-8110-4eda64eb2aa2" />

💡 **常见问题排查**
1. 服务没启动： 确保虚拟机内部的 Web 服务或应用服务已经启动，并且正在监听你设置的端口（如 80 或 22）。
2. IP 地址变了： 如果虚拟机重启后 IP 变了，NAT 映射就会断开。建议在虚拟机系统内部设置静态 IP，或者在 VMware 的 DHCP 分配范围之外固定一个 IP。
3. 杀毒软件拦截： 某些安全软件会拦截 VMware 的网络服务（如 VMware NAT Service），导致转发失效。
